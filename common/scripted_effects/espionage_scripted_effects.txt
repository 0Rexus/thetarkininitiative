scrap_espionage_mission_1 = {
	if = {
		limit = {
			has_country_flag = assassinate_slot_1
		}
		clr_country_flag = assassinate_slot_1
		var:targeted_country_slot_1 = {
			every_unit_leader = {
				limit = {
					has_character_flag = targeted_by_mission
					has_character_flag = targeted_by_@ROOT_1_murder
				}
				clr_character_flag = targeted_by_mission
				clr_character_flag = targeted_by_@ROOT_1_murder
			}
		}
	}else_if = {
		limit = {
			has_country_flag = ransom_slot_1
		}
		clr_country_flag = ransom_slot_1
		var:targeted_country_slot_1 = {
			every_unit_leader = {
				limit = {
					has_character_flag = targeted_by_mission
					has_character_flag = targeted_by_@ROOT_1_ransom
				}
				clr_character_flag = targeted_by_mission
				clr_character_flag = targeted_by_@ROOT_1_ransom
			}
		}
	}else_if = {
		limit = {
			has_country_flag = army_training_slot_1
		}
		clr_country_flag = army_training_slot_1
		every_unit_leader = {
			limit = {
				has_character_flag = targeted_by_mission
				has_character_flag = targeted_by_training_1
			}
			clr_character_flag = targeted_by_mission
			clr_character_flag = targeted_by_training_1
		}
	}else_if = {
		limit = {
			has_country_flag = steal_equipment_slot_1
		}
		clr_country_flag = steal_equipment_slot_1
	}else_if = {
		limit = {
			has_country_flag = set_Slaves_free_slot_1
		}
		clr_country_flag = set_Slaves_free_slot_1
	}else_if = {
		limit = {
			has_country_flag = smuggle_slaves_slot_1
		}
		clr_country_flag = smuggle_slaves_slot_1
	}else_if = {
		limit = {
			has_country_flag = arming_dissadents_slot_1
		}
		clr_country_flag = arming_dissadents_slot_1
	}else_if = {
		limit = {
			has_country_flag = provoke_slave_revolt_slot_1
		}
		clr_country_flag = provoke_slave_revolt_slot_1
	}else_if = {
		limit = {
			has_country_flag = capitial_ship_target_slot_1
		}
		clr_country_flag = capitial_ship_target_slot_1
	}else_if = {
		limit = {
			has_country_flag = sabotage_target_slot_1
		}
		clr_country_flag = sabotage_target_slot_1
	}else_if = {
		limit = {
			has_country_flag = infilitrate_military_target_slot_1
		}
		clr_country_flag = infilitrate_military_target_slot_1
	}else_if = {
		limit = {
			has_country_flag = undermind_guild_connections_target_slot_1
		}
		clr_country_flag = undermind_guild_connections_target_slot_1
	}else_if = {
		limit = {
			has_country_flag = cyber_attack_target_slot_1
		}
		clr_country_flag = cyber_attack_target_slot_1
	}else_if = {
		limit = {
			has_country_flag = steal_blueprint_target_slot_1
		}
		clr_country_flag = steal_blueprint_target_slot_1
	}else_if = {
		limit = {
			has_country_flag = sprout_disease_target_slot_1
		}
		clr_country_flag = sprout_disease_target_slot_1
	}else_if = {
		limit = {
			has_country_flag = logistics_sabotage_target_slot_1
		}
		clr_country_flag = logistics_sabotage_target_slot_1
	}
	clear_variable = targeted_country_slot_1
	clr_country_flag = slot_1_filled
}
scrap_espionage_mission_2 = {
	if = {
		limit = {
			has_country_flag = assassinate_slot_2
		}
		clr_country_flag = assassinate_slot_2
		var:targeted_country_slot_2 = {
			every_unit_leader = {
				limit = {
					has_character_flag = targeted_by_mission
					has_character_flag = targeted_by_@ROOT_2_murder
				}
				clr_character_flag = targeted_by_mission
				clr_character_flag = targeted_by_@ROOT_2_murder
			}
		}
	}else_if = {
		limit = {
			has_country_flag = ransom_slot_2
		}
		clr_country_flag = ransom_slot_2
		var:targeted_country_slot_2 = {
			every_unit_leader = {
				limit = {
					has_character_flag = targeted_by_mission
					has_character_flag = targeted_by_@ROOT_2_ransom
				}
				clr_character_flag = targeted_by_mission
				clr_character_flag = targeted_by_@ROOT_2_ransom
			}
		}
	}else_if = {
		limit = {
			has_country_flag = army_training_slot_2
		}
		clr_country_flag = army_training_slot_2
		every_unit_leader = {
			limit = {
				has_character_flag = targeted_by_mission
				has_character_flag = targeted_by_training_2
			}
			clr_character_flag = targeted_by_mission
			clr_character_flag = targeted_by_training_2
		}
	}else_if = {
		limit = {
			has_country_flag = steal_equipment_slot_2
		}
		clr_country_flag = steal_equipment_slot_2
	}else_if = {
		limit = {
			has_country_flag = set_Slaves_free_slot_2
		}
		clr_country_flag = set_Slaves_free_slot_2
	}else_if = {
		limit = {
			has_country_flag = smuggle_slaves_slot_2
		}
		clr_country_flag = smuggle_slaves_slot_2
	}else_if = {
		limit = {
			has_country_flag = arming_dissadents_slot_2
		}
		clr_country_flag = arming_dissadents_slot_2
	}else_if = {
		limit = {
			has_country_flag = provoke_slave_revolt_slot_2
		}
		clr_country_flag = provoke_slave_revolt_slot_2
	}else_if = {
		limit = {
			has_country_flag = capitial_ship_target_slot_2
		}
		clr_country_flag = capitial_ship_target_slot_2
	}else_if = {
		limit = {
			has_country_flag = sabotage_target_slot_2
		}
		clr_country_flag = sabotage_target_slot_2
	}else_if = {
		limit = {
			has_country_flag = infilitrate_military_target_slot_2
		}
		clr_country_flag = infilitrate_military_target_slot_2
	}else_if = {
		limit = {
			has_country_flag = undermind_guild_connections_target_slot_2
		}
		clr_country_flag = undermind_guild_connections_target_slot_2
	}else_if = {
		limit = {
			has_country_flag = cyber_attack_target_slot_2
		}
		clr_country_flag = cyber_attack_target_slot_2
	}else_if = {
		limit = {
			has_country_flag = steal_blueprint_target_slot_2
		}
		clr_country_flag = steal_blueprint_target_slot_2
	}else_if = {
		limit = {
			has_country_flag = sprout_disease_target_slot_2
		}
		clr_country_flag = sprout_disease_target_slot_2
	}else_if = {
		limit = {
			has_country_flag = logistics_sabotage_target_slot_2
		}
		clr_country_flag = logistics_sabotage_target_slot_2
	}
	clear_variable = targeted_country_slot_2
	clr_country_flag = slot_2_filled
}
scrap_espionage_mission_3 = {
	if = {
		limit = {
			has_country_flag = assassinate_slot_3
		}
		clr_country_flag = assassinate_slot_3
		var:targeted_country_slot_3 = {
			every_unit_leader = {
				limit = {
					has_character_flag = targeted_by_mission
					has_character_flag = targeted_by_@ROOT_3_murder
				}
				clr_character_flag = targeted_by_mission
				clr_character_flag = targeted_by_@ROOT_3_murder
			}
		}
	}else_if = {
		limit = {
			has_country_flag = ransom_slot_3
		}
		clr_country_flag = ransom_slot_3
		var:targeted_country_slot_3 = {
			every_unit_leader = {
				limit = {
					has_character_flag = targeted_by_mission
					has_character_flag = targeted_by_@ROOT_3_ransom
				}
				clr_character_flag = targeted_by_mission
				clr_character_flag = targeted_by_@ROOT_3_ransom
			}
		}
	}else_if = {
		limit = {
			has_country_flag = army_training_slot_3
		}
		clr_country_flag = army_training_slot_3
		every_unit_leader = {
			limit = {
				has_character_flag = targeted_by_mission
				has_character_flag = targeted_by_training_3
			}
			clr_character_flag = targeted_by_mission
			clr_character_flag = targeted_by_training_3
		}
	}else_if = {
		limit = {
			has_country_flag = steal_equipment_slot_3
		}
		clr_country_flag = steal_equipment_slot_3
	}else_if = {
		limit = {
			has_country_flag = set_Slaves_free_slot_3
		}
		clr_country_flag = set_Slaves_free_slot_3
	}else_if = {
		limit = {
			has_country_flag = smuggle_slaves_slot_3
		}
		clr_country_flag = smuggle_slaves_slot_3
	}else_if = {
		limit = {
			has_country_flag = arming_dissadents_slot_3
		}
		clr_country_flag = arming_dissadents_slot_3
	}else_if = {
		limit = {
			has_country_flag = provoke_slave_revolt_slot_3
		}
		clr_country_flag = provoke_slave_revolt_slot_3
	}else_if = {
		limit = {
			has_country_flag = capitial_ship_target_slot_3
		}
		clr_country_flag = capitial_ship_target_slot_3
	}else_if = {
		limit = {
			has_country_flag = sabotage_target_slot_3
		}
		clr_country_flag = sabotage_target_slot_3
	}else_if = {
		limit = {
			has_country_flag = infilitrate_military_target_slot_3
		}
		clr_country_flag = infilitrate_military_target_slot_3
	}else_if = {
		limit = {
			has_country_flag = undermind_guild_connections_target_slot_3
		}
		clr_country_flag = undermind_guild_connections_target_slot_3
	}else_if = {
		limit = {
			has_country_flag = cyber_attack_target_slot_3
		}
		clr_country_flag = cyber_attack_target_slot_3
	}else_if = {
		limit = {
			has_country_flag = steal_blueprint_target_slot_3
		}
		clr_country_flag = steal_blueprint_target_slot_3
	}else_if = {
		limit = {
			has_country_flag = sprout_disease_target_slot_3
		}
		clr_country_flag = sprout_disease_target_slot_3
	}else_if = {
		limit = {
			has_country_flag = logistics_sabotage_target_slot_3
		}
		clr_country_flag = logistics_sabotage_target_slot_3
	}
	clear_variable = targeted_country_slot_3
	clr_country_flag = slot_3_filled
}
grab_semi_hostile_nation_1 = {
	if = {
		limit = {
			has_variable = higher_chance_espionage_target
		}
		random = {
		    chance = 33
		    set_variable = {targeted_country_slot_1 = higher_chance_espionage_target}
		}
	}
	while_loop_effect = {
	    break = temp_break
	    limit = {
	    	NOT = {
	        	has_variable = targeted_country_slot_1
	        }
	    }
	    random_other_country = {
	    	if = {
	    		limit = {
	    			OR = {
		    			AND = {
		    				has_opinion = {
							    target = ROOT
							    value < 0
							}
							NOT = {has_government = ROOT}
		    			}
		    			AND = {
		    				has_opinion = {
							    target = ROOT
							    value < -50
							}
							has_government = ROOT
		    			}
	    			}
	    		}
	    		set_variable = {ROOT.targeted_country_slot_1 = THIS.id}
	    	}
	    }
	}
}
grab_semi_hostile_nation_2 = {
	if = {
		limit = {
			has_variable = higher_chance_espionage_target
		}
		random = {
		    chance = 33
		    set_variable = {targeted_country_slot_2 = higher_chance_espionage_target}
		}
	}
	while_loop_effect = {
	    break = temp_break
	    limit = {
	    	NOT = {
	        	has_variable = targeted_country_slot_2
	        }
	    }
	    random_other_country = {
	    	if = {
	    		limit = {
	    			OR = {
		    			AND = {
		    				has_opinion = {
							    target = ROOT
							    value < 0
							}
							NOT = {has_government = ROOT}
		    			}
		    			AND = {
		    				has_opinion = {
							    target = ROOT
							    value < -50
							}
							has_government = ROOT
		    			}
	    			}
	    		}
	    		set_variable = {ROOT.targeted_country_slot_2 = THIS.id}
	    	}
	    }
	}
}
grab_semi_hostile_nation_3 = {
	if = {
		limit = {
			has_variable = higher_chance_espionage_target
		}
		random = {
		    chance = 33
		    set_variable = {targeted_country_slot_3 = higher_chance_espionage_target}
		}
	}
	while_loop_effect = {
	    break = temp_break
	    limit = {
	    	NOT = {
	        	has_variable = targeted_country_slot_3
	        }
	    }
	    random_other_country = {
	    	if = {
	    		limit = {
	    			OR = {
		    			AND = {
		    				has_opinion = {
							    target = ROOT
							    value < 0
							}
							NOT = {has_government = ROOT}
		    			}
		    			AND = {
		    				has_opinion = {
							    target = ROOT
							    value < -50
							}
							has_government = ROOT
		    			}
	    			}
	    		}
	    		set_variable = {ROOT.targeted_country_slot_3 = THIS.id}
	    	}
	    }
	}
}
slave_raid_selector_1 = {
	find_highest_in_array = {
	     array = slaves
	     value = check_if_slaves_equal_zero
	}
	if = {
		limit = {
			has_variable = higher_chance_espionage_target
			check_variable = { check_if_slaves_equal_zero > 0 }
		}
		random = {
		    chance = 33
		    set_variable = {targeted_country_slot_1 = higher_chance_espionage_target}
		}
	}
	if = {
		limit = {
			has_war = yes
		}
		for_loop_effect = {
		    start = 0
		    end = 11
		    add = 1
		    value = time_checker
		    break = break_name
			random_enemy_country = {
				if = {
					limit = {
						check_variable = { check_if_slaves_equal_zero > 0 }
					}
					set_variable = { targeted_country_slot_1 = THIS.id }
				}
			}
			if = {
				limit = {
					check_variable = {time_checker = 10}
				}
				while_loop_effect = {
				    break = temp_break
				    limit = {
				    	NOT = {
				        	has_variable = targeted_country_slot_1
				        }
				    }
				    random_country = {
				    	if = {
				    		limit = {
				    			OR = {
					    			AND = {
					    				has_opinion = {
										    target = ROOT
										    value < 0
										}
										NOT = {has_government = ROOT}
										check_variable = { check_if_slaves_equal_zero > 0 }
					    			}
					    			AND = {
					    				has_opinion = {
										    target = ROOT
										    value < -50
										}
										has_government = ROOT
										check_variable = { check_if_slaves_equal_zero > 0 }
					    			}
				    			}
				    		}
				    		set_variable = {targeted_country_slot_1 = THIS.id}
				    	}
				    }
				}
			}
		}
	}else = {
		while_loop_effect = {
		    break = temp_break
		    limit = {
		    	NOT = {
		        	has_variable = targeted_country_slot_1
		        }
		    }
		    random_country = {
		    	if = {
		    		limit = {
		    			OR = {
			    			AND = {
			    				has_opinion = {
								    target = ROOT
								    value < 0
								}
								NOT = {has_government = ROOT}
								check_variable = { check_if_slaves_equal_zero > 0 }
			    			}
			    			AND = {
			    				has_opinion = {
								    target = ROOT
								    value < -50
								}
								has_government = ROOT
								check_variable = { check_if_slaves_equal_zero > 0 }
			    			}
		    			}
		    		}
		    		set_variable = {targeted_country_slot_1 = THIS.id}
		    	}
		    }
		}
	}
}
slave_raid_selector_2 = {
	find_highest_in_array = {
	     array = slaves
	     value = check_if_slaves_equal_zero
	}
	if = {
		limit = {
			has_variable = higher_chance_espionage_target
			check_variable = { check_if_slaves_equal_zero > 0 }
		}
		random = {
		    chance = 33
		    set_variable = {targeted_country_slot_2 = higher_chance_espionage_target}
		}
	}
	if = {
		limit = {
			has_war = yes
		}
		for_loop_effect = {
		    start = 0
		    end = 11
		    add = 1
		    value = time_checker
		    break = break_name
			random_enemy_country = {
				if = {
					limit = {
						check_variable = { check_if_slaves_equal_zero > 0 }
					}
					set_variable = { targeted_country_slot_2 = THIS.id }
				}
			}
			if = {
				limit = {
					check_variable = {time_checker = 10}
				}
				while_loop_effect = {
				    break = temp_break
				    limit = {
				    	NOT = {
				        	has_variable = targeted_country_slot_2
				        }
				    }
				    random_country = {
				    	if = {
				    		limit = {
				    			OR = {
					    			AND = {
					    				has_opinion = {
										    target = ROOT
										    value < 0
										}
										NOT = {has_government = ROOT}
										check_variable = { check_if_slaves_equal_zero > 0 }
					    			}
					    			AND = {
					    				has_opinion = {
										    target = ROOT
										    value < -50
										}
										has_government = ROOT
										check_variable = { check_if_slaves_equal_zero > 0 }
					    			}
				    			}
				    		}
				    		set_variable = {targeted_country_slot_2 = THIS.id}
				    	}
				    }
				}
			}
		}
	}else = {
		while_loop_effect = {
		    break = temp_break
		    limit = {
		    	NOT = {
		        	has_variable = targeted_country_slot_2
		        }
		    }
		    random_country = {
		    	if = {
		    		limit = {
		    			OR = {
			    			AND = {
			    				has_opinion = {
								    target = ROOT
								    value < 0
								}
								NOT = {has_government = ROOT}
								check_variable = { check_if_slaves_equal_zero > 0 }
			    			}
			    			AND = {
			    				has_opinion = {
								    target = ROOT
								    value < -50
								}
								has_government = ROOT
								check_variable = { check_if_slaves_equal_zero > 0 }
			    			}
		    			}
		    		}
		    		set_variable = {targeted_country_slot_2 = THIS.id}
		    	}
		    }
		}
	}
}
slave_raid_selector_3 = {
	find_highest_in_array = {
	     array = slaves
	     value = check_if_slaves_equal_zero
	}
	if = {
		limit = {
			has_variable = higher_chance_espionage_target
			check_variable = { check_if_slaves_equal_zero > 0 }
		}
		random = {
		    chance = 33
		    set_variable = {targeted_country_slot_3 = higher_chance_espionage_target}
		}
	}
	if = {
		limit = {
			has_war = yes
		}
		for_loop_effect = {
		    start = 0
		    end = 11
		    add = 1
		    value = time_checker
		    break = break_name
			random_enemy_country = {
				if = {
					limit = {
						check_variable = { check_if_slaves_equal_zero > 0 }
					}
					set_variable = { targeted_country_slot_3 = THIS.id }
				}
			}
			if = {
				limit = {
					check_variable = {time_checker = 10}
				}
				while_loop_effect = {
				    break = temp_break
				    limit = {
				    	NOT = {
				        	has_variable = targeted_country_slot_3
				        }
				    }
				    random_country = {
				    	if = {
				    		limit = {
				    			OR = {
					    			AND = {
					    				has_opinion = {
										    target = ROOT
										    value < 0
										}
										NOT = {has_government = ROOT}
										check_variable = { check_if_slaves_equal_zero > 0 }
					    			}
					    			AND = {
					    				has_opinion = {
										    target = ROOT
										    value < -50
										}
										has_government = ROOT
										check_variable = { check_if_slaves_equal_zero > 0 }
					    			}
				    			}
				    		}
				    		set_variable = {targeted_country_slot_3 = THIS.id}
				    	}
				    }
				}
			}
		}
	}else = {
		while_loop_effect = {
		    break = temp_break
		    limit = {
		    	NOT = {
		        	has_variable = targeted_country_slot_3
		        }
		    }
		    random_country = {
		    	if = {
		    		limit = {
		    			OR = {
			    			AND = {
			    				has_opinion = {
								    target = ROOT
								    value < 0
								}
								NOT = {has_government = ROOT}
								check_variable = { check_if_slaves_equal_zero > 0 }
			    			}
			    			AND = {
			    				has_opinion = {
								    target = ROOT
								    value < -50
								}
								has_government = ROOT
								check_variable = { check_if_slaves_equal_zero > 0 }
			    			}
		    			}
		    		}
		    		set_variable = {targeted_country_slot_3 = THIS.id}
		    	}
		    }
		}
	}
}
clear_side_guild_screen_flags = {
	if = {
		limit = {
			has_country_flag = bounty_hunter_side_screen
		}
		clr_country_flag = bounty_hunter_side_screen
	}else_if = {
		limit = {
			has_country_flag = smugglers_side_screen
		}
		clr_country_flag = smugglers_side_screen	
	}else_if = {
		limit = {
			has_country_flag = technicians_side_screen
		}
		clr_country_flag = technicians_side_screen	
	}else_if = {
		limit = {
			has_country_flag = spynet_side_screen
		}
		clr_country_flag = spynet_side_screen	
	}else_if = {
		limit = {
			has_country_flag = counter_intelligence_side_screen
		}
		clr_country_flag = counter_intelligence_side_screen	
	}
		
}
Agent_generator_main = {   ### BASIC AGENT GENERATOR
	if = {
		limit = {
			NOT = {
				has_variable = agent_operation_slot_1
			}
		}
		while_loop_effect = {
		    break = name_unique
		    limit = {
		    	NOT = {
		    		has_variable = agent_operation_slot_1
		    	}
		        OR = {
		        	check_variable = {                          ########### MAKES SURE NAME IS UNIQUE TO THIS COUNTRY, ALLOWS PULLING OF THE NAME
					    var = agent_operation_slot_1
					    value = agent_operation_slot_2
					    compare = equals
					}
					check_variable = {
					    var = agent_operation_slot_1
					    value = agent_operation_slot_3	
					    compare = equals
					}
					NOT = {
						has_variable = agent_operation_slot_1
					}
				}
		    }
			set_variable_to_random = {
			    var = agent_operation_slot_1  #### ASSIGNS NUMBER TO AGENT OPERATION SLOT FOR USE IN LATER PULLS, THIS DECIDES NAMES
			    max = 20
			    min = 1
			    integer = yes
			}
			set_variable = {current_agent_recruitment = agent_operation_slot_1}
		}
	}else_if = {
		limit = {
			NOT = {
				has_variable = agent_operation_slot_2
			}
		}
		while_loop_effect = {
		    break = name_unique
		    limit = {
		        OR = {
		        	check_variable = {                          ########### MAKES SURE NAME IS UNIQUE TO THIS COUNTRY, ALLOWS PULLING OF THE NAME
					    var = agent_operation_slot_2
					    value = agent_operation_slot_1
					    compare = equals
					}
					check_variable = {
					    var = agent_operation_slot_2
					    value = agent_operation_slot_3	
					    compare = equals
					}
					NOT = {
						has_variable = agent_operation_slot_2
					}
				}
		    }
			set_variable_to_random = {
			    var = agent_operation_slot_2  #### ASSIGNS NUMBER TO AGENT OPERATION SLOT FOR USE IN LATER PULLS, THIS DECIDES NAMES
			    max = 20
			    min = 1
			    integer = yes
			}
			set_variable = {current_agent_recruitment = agent_operation_slot_2}
		}
	}else_if = {
		limit = {
			NOT = {
				has_variable = agent_operation_slot_3
			}
		}
		log = "test"
		while_loop_effect = {
		    break = name_unique
		    limit = {
		        OR = {
		        	check_variable = {                          ########### MAKES SURE NAME IS UNIQUE TO THIS COUNTRY, ALLOWS PULLING OF THE NAME
					    var = agent_operation_slot_3
					    value = agent_operation_slot_2
					    compare = equals
					}
					check_variable = {
					    var = agent_operation_slot_3
					    value = agent_operation_slot_1
					    compare = equals
					}
					NOT = {
						has_variable = agent_operation_slot_3
					}
				}
		    }
		    log = "test"
			set_variable_to_random = {
			    var = agent_operation_slot_3  #### ASSIGNS NUMBER TO AGENT OPERATION SLOT FOR USE IN LATER PULLS, THIS DECIDES NAMES
			    max = 20
			    min = 1
			    integer = yes
			}
			set_variable = {current_agent_recruitment = agent_operation_slot_3}
		}
	}
	if = {
		limit = {
			has_country_flag = bounty_hunter_side_screen           ######################## TELLS WHICH GUILD IS THE AGENT
		}
        bounty_hunter_recruitment = yes
	}else_if = {
		limit = {
			has_country_flag = smugglers_side_screen
		}
		smugglers_recruitment = yes
	}else_if = {
		limit = {
			has_country_flag = technicians_side_screen
		}
		technicians_recruitment = yes
	}else_if = {
		limit = {
			has_country_flag = spynet_side_screen
		}
		spynet_recruitment = yes
	}else_if = {
		limit = {
			has_country_flag = counter_intelligence_side_screen
		}
		counter_intelligence_recruitment = yes
	}
}
bounty_hunter_recruitment = {
	set_variable_to_random = {
	    var = agent_portrait@var:current_agent_recruitment  #### ASSIGNS NUMBER AS AGENT PORTRAIT, SCRIPTED LOCALISATION PULLS PORTRAIT FROM NUMBER
	    max = 8
	    min = 0
	    integer = yes
	}

	set_variable =  { bounty_hunter_agent_portrait = agent_portrait@var:current_agent_recruitment}

	set_variable_to_random = {
	    var = agent_loyality@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_martial@var:current_agent_recruitment 
	    max = 20
	    min = 12
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_charisma@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_intelligence@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}

	add_to_variable = {amount_of_bounty_hunters = 1}

	clear_variable = current_agent_recruitment
}
smugglers_recruitment = {
	set_variable_to_random = {
	    var = agent_portrait@var:current_agent_recruitment  #### ASSIGNS NUMBER AS AGENT PORTRAIT, SCRIPTED LOCALISATION PULLS PORTRAIT FROM NUMBER
	    max = 27
	    min = 24
	    integer = yes
	}

	set_variable =  { smugglers_agent_portrait = agent_portrait@var:current_agent_recruitment}

	set_variable_to_random = {
	    var = agent_loyality@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_martial@var:current_agent_recruitment 
	    max = 20
	    min = 12
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_charisma@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_intelligence@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}

	add_to_variable = {amount_of_smugglers = 1}

	clear_variable = current_agent_recruitment
}
technicians_recruitment = {
	set_variable_to_random = {
	    var = agent_portrait@var:current_agent_recruitment  #### ASSIGNS NUMBER AS AGENT PORTRAIT, SCRIPTED LOCALISATION PULLS PORTRAIT FROM NUMBER
	    max = 31
	    min = 28
	    integer = yes
	}
	set_variable =  { technicians_agent_portrait = agent_portrait@var:current_agent_recruitment}

	set_variable_to_random = {
	    var = agent_loyality@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_martial@var:current_agent_recruitment 
	    max = 20
	    min = 12
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_charisma@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_intelligence@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}

	add_to_variable = {amount_of_technicians = 1}

	clear_variable = current_agent_recruitment
}
spynet_recruitment = {
	if = {
		limit = {
			has_government = imperial 
		}
		set_variable_to_random = {
		    var = agent_portrait@var:current_agent_recruitment  #### ASSIGNS NUMBER AS AGENT PORTRAIT, SCRIPTED LOCALISATION PULLS PORTRAIT FROM NUMBER
		    max = 17
		    min = 12
		    integer = yes
		}
	}else = {
		set_variable_to_random = {
		    var = agent_portrait@var:current_agent_recruitment  #### ASSIGNS NUMBER AS AGENT PORTRAIT, SCRIPTED LOCALISATION PULLS PORTRAIT FROM NUMBER
		    max = 24
		    min = 18
		    integer = yes
		}
	}
	set_variable_to_random = {
	    var = agent_portrait@var:current_agent_recruitment  #### ASSIGNS NUMBER AS AGENT PORTRAIT, SCRIPTED LOCALISATION PULLS PORTRAIT FROM NUMBER
	    max = 23
	    min = 12
	    integer = yes
	}

	set_variable =  { spynet_agent_portrait = agent_portrait@var:current_agent_recruitment}

	set_variable_to_random = {
	    var = agent_loyality@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_martial@var:current_agent_recruitment 
	    max = 20
	    min = 12
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_charisma@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_intelligence@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}

	add_to_variable = {amount_of_spies = 1}

	clear_variable = current_agent_recruitment
}
counter_intelligence_recruitment = {
	set_variable_to_random = {
	    var = agent_portrait@var:current_agent_recruitment  #### ASSIGNS NUMBER AS AGENT PORTRAIT, SCRIPTED LOCALISATION PULLS PORTRAIT FROM NUMBER
	    max = 12
	    min = 9
	    integer = yes
	}

	set_variable =  { counter_intelligence_agent_portrait = agent_portrait@var:current_agent_recruitment}

	set_variable_to_random = {
	    var = agent_loyality@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_martial@var:current_agent_recruitment 
	    max = 20
	    min = 12
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_charisma@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}
	set_variable_to_random = {
	    var = agent_intelligence@var:current_agent_recruitment
	    max = 20
	    min = 5
	    integer = yes
	}

	add_to_variable = {amount_of_counter_intelligence = 1}

	clear_variable = current_agent_recruitment
}

Slot_1_espionage_end_mission_effects = {
	if = {
		### EXAMPLE SKILL CHECK ###
		# set_variable = { agent_in_mission_1 = ### GRABS OPERATIVE FROM PALPYS GRIDBOX}
		# set_variable = { agent_loyality@var:agent_in_mission_1 = 12 }
		# check_variable = { agent_loyality@var:agent_in_mission_1 = 12 }  ## WOULD I GET 12 TELL ME YES
		# check_variable = { agent_martial@var:agent_in_mission_1 = 12 }
		# check_variable = { agent_charisma@var:agent_in_mission_1 = 12 }
		# check_variable = { agent_intelligence@var:agent_in_mission_1 = 12 }
		limit = {
			has_country_flag = slot_1_filled
		}
		randomize_temp_variable = {  ## success and failure chance generator
		  var = chance_of_success_1
		  distribution = uniform
		  min = 1
		  max = 100
		}
		############# BOUNTY HUNTER ##############################
		if = {                  ########### ASSASSIN ONLY WOUNDS
			limit = {
				has_country_flag = assassinate_slot_1 
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 } ## find characters martial and sets tempAverage to then work out success chance
			multiply_temp_variable = { tempAverage = 6 } ## 6 factor
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				if = {
					limit = {
						check_variable = {chance_of_success_1 > 10}
					}
					var:targeted_country_slot_1 = {
						every_unit_leader = {
							limit = {
								has_character_flag = targeted_by_mission
								has_character_flag = targeted_by_@ROOT_1_murder
							}
							add_timed_unit_leader_trait = {
								trait = wounded
								days = 180
							}
							unit_leader_event = {id = espionage.1}
						}
					}
				}else = {														 ### CRITICAL SUCCESSS
					var:targeted_country_slot_1 = { ### ASSASSIN KILLS TARGET
						every_unit_leader = {
							limit = {
								has_character_flag = targeted_by_mission
								has_character_flag = targeted_by_@ROOT_1_murder
							}
							retire = yes
							unit_leader_event = {id = espionage.2}
						}
					}
				}
			}
			clr_country_flag = assassinate_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = ransom_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					country_event = {
					    id = espionage.3
					    days = 1
					}
				}
			}
			clr_country_flag = ransom_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = army_training_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				every_unit_leader = {
					limit = {
						has_character_flag = targeted_by_mission
						has_character_flag = targeted_by_training_1
					}
					add_random_trait = {
						organizer
						cavalry_leader
						infantry_leader
						skilled_staffer
						trickster
						infantry_officer
						armor_officer
					}
				}
			}
			clr_country_flag = army_training_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = intimidate_senator_slot_1 ###### CHANGE_ME
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = intimidate_senator_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		########### TECHNICIAN ##################################
		if = {
			limit = {
				has_country_flag = cyber_attack_target_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					add_timed_idea = {
					    idea = cyber_attack_espionage
					    days = 100
					}
				}
			}
			clr_country_flag = cyber_attack_target_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = steal_blueprint_target_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					steal_random_tech_bonus = {
						folder = electronics_folder
						folder = industry_folder
						bonus = 3.0
						dynamic = no
						instant = yes
						name = operation_steal_tech_civilian
						target = FROM
						uses = 1
					}
				}
			}
			clr_country_flag = steal_blueprint_target_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = sprout_disease_target_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					capital_scope = {
						add_manpower = -50000
					}
				}
			}
			clr_country_flag = sprout_disease_target_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = logisitics_target_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					add_timed_idea = {
					    idea = logistics_sabotage_espionage
					    days = 40
					}
				}
			}
			clr_country_flag = logistics_sabotage_target_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		### SPY ####
		if = {
			limit = {
				has_country_flag = sabotage_target_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 12 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					while_loop_effect = {
					    break = temp_break
					    limit = {
					    	NOT = {
					        	has_variable = targeted_country_slot_1
					        }
					    }
					    random_core_state = {
					    	if = {
					    		limit = {
					    			arms_factory > 1
					    		}
					    		remove_building = {
								    type = arms_factory
								    level = 1
								}
								set_temp_variable = {temp_break = 1}
					    	}else_if = {
					    		limit = {
					    			industrial_complex > 1
					    		}
					    		remove_building = {
								    type = industrial_complex
								    level = 1
								}
								set_temp_variable = {temp_break = 1}
					    	}
					    }
					}
				}
			}
			clr_country_flag = sabotage_target_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = infiltrate_military_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 6 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				add_intel = {
				    target = var:targeted_country_slot_1
				    army_intel = 30
				    navy_intel = 30
				    airforce_intel = 30
				}
			}
			clr_country_flag = infiltrate_military_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = undermine_guild_connections_slot_1 ## CHANGE_ME no idea how to do this palpy help
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = undermine_guild_connections_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = turn_agent_slot_1 ## CHANGE_ME lol no, leaving that till last
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 6 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = turn_agent_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = capital_ship_slot_1 ## finds biggest capital ship (Super star destroyers not included due to how busted that would be)
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					if = {
						limit = {
							check_variable = {
								var = num_ships_with_type@carrier  ## CHANGE_ME, need to ask diosysnus about ship types
								value = 1
								compare = greater_than
							}
						}
						destroy_ships = {
						    type = carrier
						    count = 1
						}
					}else_if = {
						limit = {
							check_variable = {
								var = num_ships_with_type@battleship ## CHANGE_ME, need to ask diosysnus about ship types
								value = 1
								compare = greater_than
							}
						}
						destroy_ships = {
						    type = battleship
						    count = 1
						}
					}
				}
			}
			clr_country_flag = capital_ship_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		####### SMUGGLER ###############
		if = {
			limit = {
				has_country_flag = steal_equipment_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					send_equipment_fraction = {
					    value = 0.02
					    target = PREV
					}
				}
			}
			clr_country_flag = steal_equipment_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = smuggle_slaves_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					find_highest_in_array = { 
						array = slaves
						value = slave_value_count_temp
						index = slave_index_espionage_temp
					}
					divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
					multiply_variable = {slave_value_count_temp = 2}
					round_variable = slave_value_count_temp
					set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
				}
				set_variable = { slaves^targeted_country_slot_1.slave_index_espionage_temp = var:targeted_country_slot_1.slave_value_count_temp} ## this is stupid and should be treated as such
			}
			clr_country_flag = set_Slaves_free_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = set_Slaves_free_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					find_highest_in_array = { 
						array = slaves
						value = slave_value_count_temp
						index = slave_index_espionage_temp
					}
					divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
					multiply_variable = {slave_value_count_temp = 2}
					round_variable = slave_value_count_temp
					set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
				}
			}
			clr_country_flag = set_Slaves_free_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = provoke_slave_revolt_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 4 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					set_temp_variable = { slave_total_count_temp = 0 }
					for_each_loop = {
						array = slaves
						value = slave_index_count

						add_to_temp_variable = {slave_total_count_temp = slave_index_count}
					}
					divide_variable = {slave_total_count_temp = 800000}
					random_core_state = {
						 set_variable = { core_temp_state = THIS.id}
					}
					start_civil_war = {
					    ruling_party = neutrality
					    ideology = ROOT
					    size = slave_total_count_temp
					    capital = var:core_temp_state
					    navy_ratio = 0
					    states_filter = {
					    	check_variable = {var:core_temp_state = THIS.id}
					    }
					    keep_unit_leaders_trigger = {
					    	always = yes
					    }
					    keep_political_leader = yes
					    keep_political_party_members = yes
					}
				}
			}
			clr_country_flag = provoke_slave_revolt_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = arming_dissadents_slot_1_slot_1
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					every_controlled_state = {
						limit = {
							has_active_resistance = yes
						}
						add_resistance = 20 
					}
				}
			}
			clr_country_flag = arming_dissadents_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = plant_sleeper_agent_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 12 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				set_variable = {higher_chance_espionage_target = var:targeted_country_slot_1.id }
			}
			clr_country_flag = plant_sleeper_agent_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = market_flood_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					subtract_from_variable = { currency_amount^primary_currency = 1000 }
				}
			}
			clr_country_flag = plant_sleeper_agent_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
		if = {
			limit = {
				has_country_flag = reroute_supply_slot_1
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_1 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_1 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_1
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_1 = {
					give_resource_rights = { receiver = ROOT state = capital }
					country_event = {
					    id = espionage.4
					    days = 80
					}
				}
			}
			clr_country_flag = reroute_supply_slot_1
			clr_country_flag = slot_1_filled
			clear_variable = targeted_country_slot_1
		}
	}
}
Slot_2_espionage_end_mission_effects = {
	if = {
		limit = {
			has_country_flag = slot_2_filled
		}
		randomize_temp_variable = {  ## success and failure chance generator
		  var = chance_of_success_2
		  distribution = uniform
		  min = 1
		  max = 100
		}
		############# BOUNTY HUNTER ##############################
		if = {                  ########### ASSASSIN ONLY WOUNDS
			limit = {
				has_country_flag = assassinate_slot_2 
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 } ## find characters martial and sets tempAverage to then work out success chance
			multiply_temp_variable = { tempAverage = 6 } ## 6 factor
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				if = {
					limit = {
						check_variable = {chance_of_success_2 > 10}
					}
					var:targeted_country_slot_2 = {
						every_unit_leader = {
							limit = {
								has_character_flag = targeted_by_mission
								has_character_flag = targeted_by_@ROOT_1_murder
							}
							add_timed_unit_leader_trait = {
								trait = wounded
								days = 180
							}
							unit_leader_event = {id = espionage.1}
						}
					}
				}else = {														 ### CRITICAL SUCCESSS
					var:targeted_country_slot_2 = { ### ASSASSIN KILLS TARGET
						every_unit_leader = {
							limit = {
								has_character_flag = targeted_by_mission
								has_character_flag = targeted_by_@ROOT_1_murder
							}
							retire = yes
							unit_leader_event = {id = espionage.2}
						}
					}
				}
			}
			clr_country_flag = assassinate_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = ransom_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					country_event = {
					    id = espionage.3
					    days = 1
					}
				}
			}
			clr_country_flag = ransom_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = army_training_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				every_unit_leader = {
					limit = {
						has_character_flag = targeted_by_mission
						has_character_flag = targeted_by_training_2
					}
					add_random_trait = {
						organizer
						cavalry_leader
						infantry_leader
						skilled_staffer
						trickster
						infantry_officer
						armor_officer
					}
				}
			}
			clr_country_flag = army_training_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = intimidate_senator_slot_2 ###### CHANGE_ME
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = intimidate_senator_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		########### TECHNICIAN ##################################
		if = {
			limit = {
				has_country_flag = cyber_attack_target_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					add_timed_idea = {
					    idea = cyber_attack_espionage
					    days = 100
					}
				}
			}
			clr_country_flag = cyber_attack_target_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = steal_blueprint_target_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					steal_random_tech_bonus = {
						folder = electronics_folder
						folder = industry_folder
						bonus = 3.0
						dynamic = no
						instant = yes
						name = operation_steal_tech_civilian
						target = FROM
						uses = 1
					}
				}
			}
			clr_country_flag = steal_blueprint_target_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = sprout_disease_target_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					capital_scope = {
						add_manpower = -50000
					}
				}
			}
			clr_country_flag = sprout_disease_target_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = logisitics_target_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					add_timed_idea = {
					    idea = logistics_sabotage_espionage
					    days = 40
					}
				}
			}
			clr_country_flag = logistics_sabotage_target_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		### SPY ####
		if = {
			limit = {
				has_country_flag = sabotage_target_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 12 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					while_loop_effect = {
					    break = temp_break
					    limit = {
					    	NOT = {
					        	has_variable = targeted_country_slot_2
					        }
					    }
					    random_core_state = {
					    	if = {
					    		limit = {
					    			arms_factory > 1
					    		}
					    		remove_building = {
								    type = arms_factory
								    level = 1
								}
								set_temp_variable = {temp_break = 1}
					    	}else_if = {
					    		limit = {
					    			industrial_complex > 1
					    		}
					    		remove_building = {
								    type = industrial_complex
								    level = 1
								}
								set_temp_variable = {temp_break = 1}
					    	}
					    }
					}
				}
			}
			clr_country_flag = sabotage_target_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = infiltrate_military_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 6 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				add_intel = {
				    target = var:targeted_country_slot_2
				    army_intel = 30
				    navy_intel = 30
				    airforce_intel = 30
				}
			}
			clr_country_flag = infiltrate_military_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = undermine_guild_connections_slot_2 ## CHANGE_ME no idea how to do this palpy help
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = undermine_guild_connections_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = turn_agent_slot_2 ## CHANGE_ME lol no, leaving that till last
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 6 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = turn_agent_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = capital_ship_slot_2 ## finds biggest capital ship (Super star destroyers not included due to how busted that would be)
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					if = {
						limit = {
							check_variable = {
								var = num_ships_with_type@carrier  ## CHANGE_ME, need to ask diosysnus about ship types
								value = 1
								compare = greater_than
							}
						}
						destroy_ships = {
						    type = carrier
						    count = 1
						}
					}else_if = {
						limit = {
							check_variable = {
								var = num_ships_with_type@battleship ## CHANGE_ME, need to ask diosysnus about ship types
								value = 1
								compare = greater_than
							}
						}
						destroy_ships = {
						    type = battleship
						    count = 1
						}
					}
				}
			}
			clr_country_flag = capital_ship_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		####### SMUGGLER ###############
		if = {
			limit = {
				has_country_flag = steal_equipment_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					send_equipment_fraction = {
					    value = 0.02
					    target = PREV
					}
				}
			}
			clr_country_flag = steal_equipment_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = smuggle_slaves_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					find_highest_in_array = { 
						array = slaves
						value = slave_value_count_temp
						index = slave_index_espionage_temp
					}
					divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
					multiply_variable = {slave_value_count_temp = 2}
					round_variable = slave_value_count_temp
					set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
				}
				set_variable = { slaves^targeted_country_slot_2.slave_index_espionage_temp = var:targeted_country_slot_2.slave_value_count_temp} ## this is stupid and should be treated as such
			}
			clr_country_flag = set_Slaves_free_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = set_Slaves_free_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					find_highest_in_array = { 
						array = slaves
						value = slave_value_count_temp
						index = slave_index_espionage_temp
					}
					divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
					multiply_variable = {slave_value_count_temp = 2}
					round_variable = slave_value_count_temp
					set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
				}
			}
			clr_country_flag = set_Slaves_free_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = provoke_slave_revolt_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 4 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					set_temp_variable = { slave_total_count_temp = 0 }
					for_each_loop = {
						array = slaves
						value = slave_index_count

						add_to_temp_variable = {slave_total_count_temp = slave_index_count}
					}
					divide_variable = {slave_total_count_temp = 800000}
					random_core_state = {
						 set_variable = { core_temp_state = THIS.id}
					}
					start_civil_war = {
					    ruling_party = neutrality
					    ideology = ROOT
					    size = slave_total_count_temp
					    capital = var:core_temp_state
					    navy_ratio = 0
					    states_filter = {
					    	check_variable = {var:core_temp_state = THIS.id}
					    }
					    keep_unit_leaders_trigger = {
					    	always = yes
					    }
					    keep_political_leader = yes
					    keep_political_party_members = yes
					}
				}
			}
			clr_country_flag = provoke_slave_revolt_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = arming_dissadents_slot_2_slot_2
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					every_controlled_state = {
						limit = {
							has_active_resistance = yes
						}
						add_resistance = 20 
					}
				}
			}
			clr_country_flag = arming_dissadents_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = plant_sleeper_agent_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 12 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				set_variable = {higher_chance_espionage_target = var:targeted_country_slot_2.id }
			}
			clr_country_flag = plant_sleeper_agent_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = market_flood_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					subtract_from_variable = { currency_amount^primary_currency = 1000 }
				}
			}
			clr_country_flag = plant_sleeper_agent_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
		if = {
			limit = {
				has_country_flag = reroute_supply_slot_2
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_2 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_2 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_2
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_2 = {
					give_resource_rights = { receiver = ROOT state = capital }
					country_event = {
					    id = espionage.4
					    days = 80
					}
				}
			}
			clr_country_flag = reroute_supply_slot_2
			clr_country_flag = slot_2_filled
			clear_variable = targeted_country_slot_2
		}
	}
}
Slot_3_espionage_end_mission_effects = {
	if = {
		limit = {
			has_country_flag = slot_3_filled
		}
		randomize_temp_variable = {  ## success and failure chance generator
		  var = chance_of_success_3
		  distribution = uniform
		  min = 1
		  max = 100
		}
		############# BOUNTY HUNTER ##############################
		if = {                  ########### ASSASSIN ONLY WOUNDS
			limit = {
				has_country_flag = assassinate_slot_3 
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 } ## find characters martial and sets tempAverage to then work out success chance
			multiply_temp_variable = { tempAverage = 6 } ## 6 factor
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				if = {
					limit = {
						check_variable = {chance_of_success_3 > 10}
					}
					var:targeted_country_slot_3 = {
						every_unit_leader = {
							limit = {
								has_character_flag = targeted_by_mission
								has_character_flag = targeted_by_@ROOT_1_murder
							}
							add_timed_unit_leader_trait = {
								trait = wounded
								days = 180
							}
							unit_leader_event = {id = espionage.1}
						}
					}
				}else = {														 ### CRITICAL SUCCESSS
					var:targeted_country_slot_3 = { ### ASSASSIN KILLS TARGET
						every_unit_leader = {
							limit = {
								has_character_flag = targeted_by_mission
								has_character_flag = targeted_by_@ROOT_1_murder
							}
							retire = yes
							unit_leader_event = {id = espionage.2}
						}
					}
				}
			}
			clr_country_flag = assassinate_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = ransom_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					country_event = {
					    id = espionage.3
					    days = 1
					}
				}
			}
			clr_country_flag = ransom_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = army_training_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				every_unit_leader = {
					limit = {
						has_character_flag = targeted_by_mission
						has_character_flag = targeted_by_training_3
					}
					add_random_trait = {
						organizer
						cavalry_leader
						infantry_leader
						skilled_staffer
						trickster
						infantry_officer
						armor_officer
					}
				}
			}
			clr_country_flag = army_training_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = intimidate_senator_slot_3 ###### CHANGE_ME
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = intimidate_senator_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		########### TECHNICIAN ##################################
		if = {
			limit = {
				has_country_flag = cyber_attack_target_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					add_timed_idea = {
					    idea = cyber_attack_espionage
					    days = 100
					}
				}
			}
			clr_country_flag = cyber_attack_target_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = steal_blueprint_target_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					steal_random_tech_bonus = {
						folder = electronics_folder
						folder = industry_folder
						bonus = 3.0
						dynamic = no
						instant = yes
						name = operation_steal_tech_civilian
						target = FROM
						uses = 1
					}
				}
			}
			clr_country_flag = steal_blueprint_target_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = sprout_disease_target_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					capital_scope = {
						add_manpower = -50000
					}
				}
			}
			clr_country_flag = sprout_disease_target_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = logisitics_target_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					add_timed_idea = {
					    idea = logistics_sabotage_espionage
					    days = 40
					}
				}
			}
			clr_country_flag = logistics_sabotage_target_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		### SPY ####
		if = {
			limit = {
				has_country_flag = sabotage_target_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 12 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					while_loop_effect = {
					    break = temp_break
					    limit = {
					    	NOT = {
					        	has_variable = targeted_country_slot_3
					        }
					    }
					    random_core_state = {
					    	if = {
					    		limit = {
					    			arms_factory > 1
					    		}
					    		remove_building = {
								    type = arms_factory
								    level = 1
								}
								set_temp_variable = {temp_break = 1}
					    	}else_if = {
					    		limit = {
					    			industrial_complex > 1
					    		}
					    		remove_building = {
								    type = industrial_complex
								    level = 1
								}
								set_temp_variable = {temp_break = 1}
					    	}
					    }
					}
				}
			}
			clr_country_flag = sabotage_target_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = infiltrate_military_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 6 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				add_intel = {
				    target = var:targeted_country_slot_3
				    army_intel = 30
				    navy_intel = 30
				    airforce_intel = 30
				}
			}
			clr_country_flag = infiltrate_military_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = undermine_guild_connections_slot_3 ## CHANGE_ME no idea how to do this palpy help
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = undermine_guild_connections_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = turn_agent_slot_3 ## CHANGE_ME lol no, leaving that till last
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 6 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
			}
			clr_country_flag = turn_agent_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = capital_ship_slot_3 ## finds biggest capital ship (Super star destroyers not included due to how busted that would be)
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 5 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					if = {
						limit = {
							check_variable = {
								var = num_ships_with_type@carrier  ## CHANGE_ME, need to ask diosysnus about ship types
								value = 1
								compare = greater_than
							}
						}
						destroy_ships = {
						    type = carrier
						    count = 1
						}
					}else_if = {
						limit = {
							check_variable = {
								var = num_ships_with_type@battleship ## CHANGE_ME, need to ask diosysnus about ship types
								value = 1
								compare = greater_than
							}
						}
						destroy_ships = {
						    type = battleship
						    count = 1
						}	
					}
				}
			}
			clr_country_flag = capital_ship_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		####### SMUGGLER ###############
		if = {
			limit = {
				has_country_flag = steal_equipment_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					send_equipment_fraction = {
					    value = 0.02
					    target = PREV
					}
				}
			}
			clr_country_flag = steal_equipment_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = smuggle_slaves_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					find_highest_in_array = { 
						array = slaves
						value = slave_value_count_temp
						index = slave_index_espionage_temp
					}
					divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
					multiply_variable = {slave_value_count_temp = 2}
					round_variable = slave_value_count_temp
					set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
				}
				set_variable = { slaves^targeted_country_slot_3.slave_index_espionage_temp = var:targeted_country_slot_3.slave_value_count_temp} ## this is stupid and should be treated as such
			}
			clr_country_flag = set_Slaves_free_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = set_Slaves_free_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					find_highest_in_array = { 
						array = slaves
						value = slave_value_count_temp
						index = slave_index_espionage_temp
					}
					divide_variable = {slave_value_count_temp = 3} ## Thought this might be cleaner
					multiply_variable = {slave_value_count_temp = 2}
					round_variable = slave_value_count_temp
					set_variable = { slaves^slave_index_espionage_temp = slave_value_count_temp }
				}
			}
			clr_country_flag = set_Slaves_free_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = provoke_slave_revolt_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 4 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					set_temp_variable = { slave_total_count_temp = 0 }
					for_each_loop = {
						array = slaves
						value = slave_index_count

						add_to_temp_variable = {slave_total_count_temp = slave_index_count}
					}
					divide_variable = {slave_total_count_temp = 800000}
					random_core_state = {
						 set_variable = { core_temp_state = THIS.id}
					}
					start_civil_war = {
					    ruling_party = neutrality
					    ideology = ROOT
					    size = slave_total_count_temp
					    capital = var:core_temp_state
					    navy_ratio = 0
					    states_filter = {
					    	check_variable = {var:core_temp_state = THIS.id}
					    }
					    keep_unit_leaders_trigger = {
					    	always = yes
					    }
					    keep_political_leader = yes
					    keep_political_party_members = yes
					}
				}
			}
			clr_country_flag = provoke_slave_revolt_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = arming_dissadents_slot_3_slot_3
			}
			set_temp_variable = { tempAverage = agent_martial@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 10 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					every_controlled_state = {
						limit = {
							has_active_resistance = yes
						}
						add_resistance = 20 
					}
				}
			}
			clr_country_flag = arming_dissadents_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = plant_sleeper_agent_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 12 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				set_variable = {higher_chance_espionage_target = var:targeted_country_slot_3.id }
			}
			clr_country_flag = plant_sleeper_agent_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = market_flood_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					subtract_from_variable = { currency_amount^primary_currency = 1000 }
				}
			}
			clr_country_flag = plant_sleeper_agent_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
		if = {
			limit = {
				has_country_flag = reroute_supply_slot_3
			}
			set_temp_variable = { tempAverage = agent_intelligence@var:agent_in_mission_3 }
			add_to_temp_variable = { tempAverage = agent_charisma@var:agent_in_mission_3 }
			divide_temp_variable = { tempAverage = 2 }
			multiply_temp_variable = { tempAverage = 8 }
			if = {
				limit = {
					check_variable = {
						var = chance_of_success_3
						value = tempAverage
						compare = less_than_or_equals
					}
				}
				var:targeted_country_slot_3 = {
					give_resource_rights = { receiver = ROOT state = capital }
					country_event = {
					    id = espionage.4
					    days = 80
					}
				}
			}
			clr_country_flag = reroute_supply_slot_3
			clr_country_flag = slot_3_filled
			clear_variable = targeted_country_slot_3
		}
	}
}
